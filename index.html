<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Druckluftmafia</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <style>
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        main {
            flex: 1;
        }

        /* Gig Card Hover Effekt */
        .gig-card:hover {
            background-color: #4338ca !important; /* dunkleres Bootstrap primary */
            border-color: #1e293b !important;
            box-shadow: 0 8px 32px rgba(49, 46, 129, 0.25);
            transform: translateY(-6px) scale(1.03);
            transition: background-color 0.18s, box-shadow 0.18s, transform 0.18s;
        }
    </style>
</head>
<body>
<!-- Header -->
<nav class="navbar navbar-expand-lg navbar-light bg-secondary">
    <div class="container">
        <span class="navbar-brand fw-bold">Druckluftmafia</span>
        <div class="ms-auto">
            <a href="https://www.instagram.com/druckluftmafia/" target="_blank" class="nav-link">
                <i class="bi bi-instagram"></i>
            </a>
        </div>
        <!-- Theme Switcher Dropdown -->
        <div class="dropdown ms-2 bd-mode-toggle" style="z-index: 10;">
            <button class="btn btn-secondary px-3 py-2 dropdown-toggle" id="bd-theme" type="button"
                    data-bs-toggle="dropdown" aria-expanded="false"
                    aria-label="Farbschema (hell/dunkel/auto)">
                <i class="bi bi-circle-half theme-icon-active"></i>
                <span id="bd-theme-text" class="ms-2"></span>
            </button>
            <ul class="dropdown-menu dropdown-menu-end shadow">
                <li>
                    <button type="button" class="dropdown-item d-flex align-items-center"
                            data-bs-theme-value="light">
                        <i class="bi bi-sun-fill me-2"></i>
                        Hell
                        <span class="ms-auto"></span>
                    </button>
                </li>
                <li>
                    <button type="button" class="dropdown-item d-flex align-items-center"
                            data-bs-theme-value="dark">
                        <i class="bi bi-moon-stars-fill me-2"></i>
                        Dunkel
                        <span class="ms-auto"></span>
                    </button>
                </li>
                <li>
                    <button type="button" class="dropdown-item d-flex align-items-center active"
                            data-bs-theme-value="auto">
                        <i class="bi bi-circle-half me-2"></i>
                        Automatisch
                        <span class="ms-auto"></span>
                    </button>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- Main Content -->
<main class="container my-4">
    <h2 class="mb-4">Nächste Gigs</h2>
    <div id="gigs-list" class="row gy-3"></div>
</main>

<!-- Footer -->
<footer class="py-3 mt-auto">
    <div class="container d-flex justify-content-between align-items-center">
        <small>© Druckluftmafia &mdash; Dies ist eine private Musikseite. Keine kommerzielle
            Nutzung.</small>
        <a href="https://www.instagram.com/druckluftmafia/" target="_blank" class="text-dark">
            <i class="bi bi-instagram"></i>
        </a>
    </div>
</footer>

<!-- Gigs laden -->
<script>
    fetch('gigs.json')
        .then(response => response.json())
        .then(gigs => {
            const container = document.getElementById('gigs-list');
            gigs.forEach(gig => {
                const col = document.createElement('div');
                col.className = 'col-md-6 col-lg-4';
                col.innerHTML = `
            <div class="card gig-card bg-primary text-white border-primary shadow h-100">
              <div class="card-body">
                <h5 class="card-title">${gig.desc}</h5>
                <p class="card-text">
                  <strong>Datum:</strong> ${gig.date}<br>
                  <strong>Ort:</strong> ${gig.location}<br>
                  <strong>Zeit:</strong> ${gig.time}
                </p>
              </div>
            </div>
          `;
                container.appendChild(col);
            });
        });

    (() => {
        'use strict'

        const getStoredTheme = () => localStorage.getItem('theme')
        const setStoredTheme = theme => localStorage.setItem('theme', theme)

        const getPreferredTheme = () => {
            const storedTheme = getStoredTheme()
            if (storedTheme) {
                return storedTheme
            }
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
        }

        const setTheme = theme => {
            if (theme === 'auto') {
                document.documentElement.setAttribute('data-bs-theme', (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'))
            } else {
                document.documentElement.setAttribute('data-bs-theme', theme)
            }
        }

        setTheme(getPreferredTheme())

        const showActiveTheme = (theme, focus = false) => {
            const themeSwitcher = document.querySelector('#bd-theme')
            if (!themeSwitcher) return

            const themeSwitcherText = document.querySelector('#bd-theme-text')
            const activeThemeIcon = document.querySelector('.theme-icon-active')
            const btnToActive = document.querySelector(`[data-bs-theme-value="${theme}"]`)
            const iconClassMap = {
                light: 'bi-sun-fill',
                dark: 'bi-moon-stars-fill',
                auto: 'bi-circle-half'
            }
            // Setze das Icon entsprechend dem aktiven Theme
            activeThemeIcon.className = `bi ${iconClassMap[theme]} theme-icon-active`

            document.querySelectorAll('[data-bs-theme-value]').forEach(element => {
                element.classList.remove('active')
                element.setAttribute('aria-pressed', 'false')
            })

            btnToActive.classList.add('active')
            btnToActive.setAttribute('aria-pressed', 'true')
            const themeSwitcherLabel = `${themeSwitcherText.textContent} (${btnToActive.dataset.bsThemeValue})`
            themeSwitcher.setAttribute('aria-label', themeSwitcherLabel)

            if (focus) themeSwitcher.focus()
        }

        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
            const storedTheme = getStoredTheme()
            if (storedTheme !== 'light' && storedTheme !== 'dark') {
                setTheme(getPreferredTheme())
            }
        })

        window.addEventListener('DOMContentLoaded', () => {
            // Setze den Text für den Theme-Switcher
            showActiveTheme(getPreferredTheme())
            document.querySelectorAll('[data-bs-theme-value]')
                .forEach(toggle => {
                    toggle.addEventListener('click', () => {
                        const theme = toggle.getAttribute('data-bs-theme-value')
                        setStoredTheme(theme)
                        setTheme(theme)
                        showActiveTheme(theme, true)
                    })
                })
            // Lade die vorhandenen Events
            loadGigs();
            // Initialisiere SortableJS
            Sortable.create(document.getElementById("gigsContainer"), {
                animation: 150,
                ghostClass: "sortable-ghost",
                chosenClass: "sortable-chosen"
            });
        })
    })()
</script>
</body>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</html>
